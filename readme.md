# Universal Layout

Универсальная раскладка — пакет комбинированной русской и английской раскладки для Windows, Linux и macOS[^old-version]. Раскладка спроектирована для повышенного удобства ввода различных символов. Присутствует также версия для ортолинейных и сплит-клавиатур.

![universal-layout-base-layer](./images/universal-layout-base-layer.jpg)

## Содержание

- [Происхождение](#происхождение)
- [Что не так со стандартными раскладками?](#что-не-так-со-стандартными-раскладками)
- [Как это решает универсальная раскладка?](#как-это-решает-универсальная-раскладка)
- [К чему придётся привыкнуть](#к-чему-придётся-привыкнуть)
- [Слой специальных символов (AltGr + <kbd>key</kbd>)](#слой-специальных-символов-altgr--key)
- [Версия для ортолинейных клавиатур](#версия-для-ортолинейных-клавиатур)
- [О минусах и багах](#о-минусах-и-багах)
- [Как установить?](#как-установить)
  - [Windows 10/11](#windows-1011)
  - [Linux](#linux)
  - [macOS](#macos)
- [Благодарности](#благодарности)

## Происхождение

Мне очень понравилась идея [универсальной раскладки](https://tonsky.livejournal.com/318571.html) Никиты Прокопова, в особенности логичное использование клавиш точки для двоеточия, а запятой для точки с запятой.

В итоге мной была разработана своя версия английской и русской раскладок, в которых «одинаковые» символы расположены на отдельных клавишах.

Также большим плюсом для меня является лёгкий способ вводить кавычки `«` и `»`, а также ворох специальных символов на слое AltGr.

## Что не так со стандартными раскладками?

![symbol-chaos](./images/symbol-chaos.png)

> Стандартная русская раскладка проектировалась по остаточному принципу, исходя из условия, что латинскую менять нельзя. Это привело к тому, что в русской раскладке пунктуация (запятая, точка, двоеточие, точка с запятой, кавычка, вопрос) расположены в других местах, нежели в английской. А кое-что в русской раскладке и вовсе нельзя набрать, например, одинарную кавычку.
>
> — Nikita Prokopov (@tonsky)

Подробнее почитать о проблемах стандартных раскладок можно здесь:

- [Правильная русская клавиатура](https://tonsky.livejournal.com/318571.html)
- [Артемий Лебедев. Трагедия запятой](https://www.artlebedev.ru/kovodstvo/sections/105/).

## Как это решает универсальная раскладка?

- Вся пунктуация стоит на одних и тех же местах как для русского, так и для английского языка
- Есть несколько клавиш, которые собрали в себя все похожие символы, которые раньше были разбросаны по клавиатуре: <kbd>'"`</kbd>, <kbd>/|\\</kbd>, <kbd>-\_—</kbd> и <kbd>=+≠±</kbd>
- <kbd>[</kbd> <kbd>]</kbd> <kbd>{</kbd> <kbd>}</kbd> и <kbd>'</kbd> теперь можно ввести и на русской раскладке

## К чему придётся привыкнуть?

- Раскладка объединяет в себе русскую и английскую раскладки, которые переключаются по клавише <kbd>Caps Lock</kbd>
- На месте цифр расположены символы, и наоборот, на месте символов — цифры. К примеру, <kbd>7</kbd> = <kbd>Shift</kbd> + <kbd>?</kbd>
- В стандартной версии буквы Б и Ю поменяли своё расположение. В версии для ортолинейных клавиатур изменений ещё больше, подробнее о них [написано ниже](#версия-для-ортолинейных-клавиатур)
- <kbd>Ъ</kbd> <kbd>Ё</kbd> <kbd>₽</kbd> <kbd>€</kbd> вынесены на слой с модификатором <kbd>Alt</kbd>.

## Слой специальных символов (AltGr + \<key\>)

![universal-layout-alt-layer](./images/universal-layout-alt-layer.jpg)

## Версия для ортолинейных клавиатур

![universal-layout-base-layer](./images/universal-layout-ortho-base-layer.jpg)
![universal-layout-alt-layer](./images/universal-layout-ortho-alt-layer.jpg)

Для ортолинейных клавиатур буквы русского и английского алфавита помещены в сетку 2×15. Для этого пришлось пожертвовать тремя буквами русского алфавита, которые не уместились в сетку. Однако, они расположены весьма логично и запоминаются мнемонически:

<kbd>Ё</kbd> = <kbd>Alt</kbd> + <kbd>Е</kbd> <br>
<kbd>Ъ</kbd> = <kbd>Alt</kbd> + <kbd>Ь</kbd> <br>
<kbd>Щ</kbd> = <kbd>Alt</kbd> + <kbd>Ш</kbd> <br>

Также, эта раскладка используется в [36-клавишной раскладке Wellum](https://github.com/braindefender/wellum/blob/master/README_RU.md)

## О минусах и багах

- Если вы используете RDP или VNC, то раскладка в них работать не будет. Если очень хочется, можно поставить её и на удалённые машины, но это опция зачастую недоступна.
- Некоторые приложения Windows принудительно добавляют дефолтную раскладку, которая была установлена по-умолчанию в системе. При этом, раскладка не отображается в списке доступных для языка. Чтобы это исправить, надо вручную добавить дефолтную раскладку и удалить.
- Есть [проблемы в работе AltGr](#баги) на Linux. Их можно исправить, но в каждом конкретном случае нужно будет разбираться отдельно. К сожалению, любой софт не идеален. Например, Linux не поддерживает ввод лигатур (<kbd>Alt</kbd> + <kbd>K</kbd> = <kbd>=></kbd>).

> Не смотря на все эти баги, я пользуюсь этой раскладкой более 5 лет и удобство от её использования перевешивает все описанные проблемы. Единственная система, где раскладка работает идеально — macOS.

## Как установить?

В папке `layouts` репозитория есть версии для Windows, Linux и macOS.

### Windows 10/11

1. Запустить `setup.exe` нужной версии и дождаться установки.
2. Установить раскладку в настройках системы: `Настройки` > `Время и язык` > `Язык и регион` > `Английский (США)` > `Меню три точки` > `Языковые параметры` > `Добавить раскладку`
3. _(Опционально)_ Удалить из списка стандартную раскладку для английского языка. В случае, если система установлена на английском языке, то можно целиком удалить русский язык на предыдущем экране.
4. _(Опционально)_ Установить раскладку в качестве стандартной для Экрана входа Windows в меню `Административные языковые параметры` > `Копировать параметры`.
5. Перезагрузить ПК. Лишним не будет.

### Linux

> Люблю линукс за то, что можно всё настраивать. Правда тебе **приходится** всё настраивать.

1. Поместить содержимое папки `layouts/Linux/xkb` в `~/.config/xkb`.
2. Далее, способ установки зависит от окружения рабочего стола (Desktop Environment):
   - GNOME: в Gnome Tweaks в настройках клавиатуры включить опцию Universal Layout.
   - i3wm, herbstluftwm и другие WM на X Window System: добавить в автозапуск следующие команды:
     ```sh
     xkbcomp $HOME/.config/xkb/symbols/universal $DISPLAY 2>&1
     xmodmap -e "keycode 108 = Alt_R Meta_R Alt_R Meta_R"
     ```
   - Для sway, hyprland и других WM на Wayland: ищите инструкцию в документации своего оконного менеджера.

#### **Баги:**

- У приложений, работающих на Wayland и Electron есть баг, когда правый Alt (AltGr) регистрируется только как горячая клавиша для некоторых клавиш. Чтобы это исправить, есть несколько вариантов:
  - Изменить регистрацию модификатора Mod3 (RAlt) на уровне XKB.
  - Использовать в прошивке клавиатуры клавишу Hiragana/Katakana, которая дублирует поведение AltGr.

### macOS

**Внимание! Версия является устаревшей**

> Как временное решение, можете использовать Ukulele для редактирования раскладки в соответствии с изображениями.

1. Файл `layouts/macOS/Universal.bundle` скопировать в `~/Library/Keyboard Layouts`.
2. Выбрать соответствующие раскладки в `Настройки системы > Клавиатура > Источники ввода`
3. _(Опционально)_ Удалить стандартные раскладки русского и английского языка. Чтобы удалить стандартную US раскладку нужно сначала добавить японскую, удалить английскую и затем удалить японскую.
4. Перезайти в систему.

## Todo

- Обновить версию для macOS
- Добавить flake для NixOS

## Благодарности

Никите Прокопову [@nikitonsky](https://twitter.com/nikitonsky) за оригинальную идею и ресурсы. Репозиторий оригинальной Universal Layout на [GitHub](https://github.com/tonsky/Universal-Layout/).

Дмитрию Ковалёву [@devpew](https://devpew.com/blog/) за [хорошие видео](https://www.youtube.com/@johenews21/videos) о кастомных механических и раздельных эргономичных клавиатурах.

Русскоязычному сообществу эргономичных раскладок и клавиатур [@klavaorgwork](https://t.me/klavaorgwork) за помощь и обратную связь.

[^old-version]: **Внимание! Версия является устаревшей**
